[tools]
node = "latest"
go = "latest"

[tasks.build]
run = "go build ./..."

[tasks.test]
run = "go test ./..."

[tasks.vet]
run = "go vet ./..."

[tasks.integration]
run = "bin/vibehost-integration"

[tasks."build:image"]
run = "docker build -t vibehost:local ."

[tasks."release:build"]
run = """
rm -rf dist
mkdir -p dist
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o dist/vibehost-linux-amd64 ./cmd/vibehost
CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -o dist/vibehost-linux-arm64 ./cmd/vibehost
CGO_ENABLED=0 GOOS=darwin GOARCH=amd64 go build -o dist/vibehost-darwin-amd64 ./cmd/vibehost
CGO_ENABLED=0 GOOS=darwin GOARCH=arm64 go build -o dist/vibehost-darwin-arm64 ./cmd/vibehost
CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o dist/vibehost-server-linux-amd64 ./cmd/vibehost-server
CGO_ENABLED=0 GOOS=linux GOARCH=arm64 go build -o dist/vibehost-server-linux-arm64 ./cmd/vibehost-server
"""

[tasks."release:push-image"]
run = """
: "${IMAGE:?IMAGE is required (e.g., ghcr.io/OWNER/REPO/vibehost:TAG)}"
docker build -t "$IMAGE" .
docker push "$IMAGE"
"""
