#!/bin/sh
set -eu

mode="${1:-}"
app="${VIBEHOST_APP:-}"
port="${VIBEHOST_HOST_PORT:-}"

case "$mode" in
  left)
    if [ -n "$app" ]; then
      printf "vibehost %s" "$app"
    else
      printf "vibehost"
    fi
    ;;
  right)
    if [ -z "$port" ]; then
      exit 0
    fi
    if command -v ss >/dev/null 2>&1; then
      if ss -ltn 2>/dev/null | grep -q ":8080 "; then
        printf "http://localhost:%s" "$port"
      fi
    elif command -v netstat >/dev/null 2>&1; then
      if netstat -ltn 2>/dev/null | grep -q ":8080 "; then
        printf "http://localhost:%s" "$port"
      fi
    else
      printf "http://localhost:%s" "$port"
    fi
    ;;
esac
